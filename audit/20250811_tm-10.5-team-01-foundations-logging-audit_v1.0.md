---
title: "Audit — Logging structuré & modèle d’erreurs"
doc_kind: audit
team: team-01
team_name: foundations
tm_ids: [10.5]
scope: logging
status: draft
version: 1.0
author: ia
related_files: [docs/spec/LOGGING_ERRORS_SPEC.md, docs/spec/openapi.yaml]
---

# Audit — Logging structuré & modèle d’erreurs

#TEST: logs — présence correlation_id et duration_ms dans un appel nominal
#TEST: erreurs — ErrorResponse complet (code,message,details?,correlation_id) pour 400|401|403|422|500
#TEST: redaction — absence de `Authorization`/secrets dans les logs

## Résumé (TL;DR)

- Objet: vérifier parité des logs JSON (structure, champs, corrélation) et conformité du modèle d’erreurs aux conventions.
- Décision: à compléter après exécution des tests contractuels/intégration.
- Points bloquants: logs non structurés, absence de correlation_id, erreurs non normalisées.

## Références

- Spécifications: `docs/spec/LOGGING_ERRORS_SPEC.md`, `docs/spec/openapi.yaml`
- Workflows originaux: `docs/clone/` (pour la tonalité et le niveau de logs attendus)
- Annexes payloads: `docs/ANNEXES_PAYLOADS.md`

## Méthodologie

- Jeux d’essai: appels réussis/échoués sur `/webhook/chat`, `/webhook/process-document`, `/webhook/generate-audio`.
- Procédure: capturer les logs (JSON lines), vérifier les champs clés et la redaction; provoquer des erreurs pour chaque code attendu.
- ENVs: activer un niveau log info/debug si disponible; s’assurer de ne pas logguer de secrets.

## Vérifications de parité

- HTTP: ErrorResponse conforme (400|401|403|422|500), 503 sur `/ready`.
- Logs: JSON, `correlation_id` propagé, `status`, `duration_ms`, `event_code` aux étapes clés.
- Sécurité: pas de secrets dans les logs (Authorization redacted).

## Résultats

- Observations: à compléter.
- Écarts détectés: à compléter.
- Captures/logs: à joindre.

## Recommandations & décisions

- Actions requises: à compléter.
- Acceptation conditionnelle / Refus: à compléter.

## Limitations

- La granularité des `event_code` peut différer marginalement si l’original n’expose pas le détail exact; conserver les champs pivots.

## Suivi Task‑Master

- Tâches liées: 10.2 (SPEC), 10.3 (IMPL), 10.4 (TEST), 10.5 (AUDIT)
- Commandes:
  - `task-master set-status --id=10.5 --status=review`
  - `task-master set-status --id=10.5 --status=done`

## Historique des versions

- v1.0: création de l’audit

