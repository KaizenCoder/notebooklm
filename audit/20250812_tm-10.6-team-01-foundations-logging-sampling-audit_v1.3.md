---
title: "Audit — tm-10.6 (Foundations Logging Sampling)"
doc_kind: audit
team: team-01
team_name: foundations
version: 1.3
status: reviewed
author: AI-Implementateur
tm_ids: [10.6]
scope: logging-sampling
related_files:
  - orchestrator/src/app.ts
  - orchestrator/test/contract/logging-sampling.test.ts
  - docs/TECHNICAL_GUIDELINES.md
---

#TEST: orchestrator/test/contract/logging-sampling.test.ts

## Contexte
- Objectif: introduire un échantillonnage configurable des logs de requête pour réduire le volume sans perdre les erreurs critiques.

## Implémentation
- Hook `onResponse` lit `LOG_SAMPLE_PCT` (0..100). Pour les réponses < 400, log "request complete" avec probabilité `LOG_SAMPLE_PCT%`. Pour les réponses ≥ 400, on log toujours (non soumis au sampling).
- Redaction des en‑têtes sensibles appliquée avant log.

## Tests
- `logging-sampling.test.ts` définit `LOG_SAMPLE_PCT=0` et vérifie qu'aucun "request complete" n'est émis pour une 2xx.
- Les suites existantes confirment que les erreurs et événements métiers restent loggés.

## Limitations
- Le sampling ne s'applique qu'au log de fin de requête; les événements métier (RAG/TTS/UPLOAD/etc.) ne sont pas échantillonnés par design.

## Décision
- tm‑10.6 conforme: sampling activable via env, redaction intacte, non‑régression tests.
