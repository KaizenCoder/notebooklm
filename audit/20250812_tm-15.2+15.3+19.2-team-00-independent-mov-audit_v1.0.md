---
title: "MOV — Audit indépendant: Idempotency 15.2/15.3 + Ingestion (texte) 19.2"
doc_kind: audit
team: team-00
team_name: independent
tm_ids: [15.2, 15.3, 19.2]
scope: idempotency|ingestion-text|no-mocks|logging
status: accepted
version: 1.0
author: ia
related_files:
  - orchestrator/src/app.ts
  - orchestrator/src/services/idempotency.ts
  - scripts/git-hooks/pre-push.ps1
  - ci/anti-mock-scan.ps1
  - ci/no-mocks-check.ps1
  - ci/local-ci.ps1
---

#TEST: orchestrator/test/contract/idempotency.test.ts
#TEST: orchestrator/test/contract/idempotency-additional-sources.test.ts
#TEST: orchestrator/test/contract/additional-sources.test.ts
#TEST: orchestrator/test/contract/process-document-status.test.ts
#TEST: orchestrator/test/integration/process-document-step-logs.test.ts
#TEST: orchestrator/test/e2e/process-document-edge.test.ts

## TL;DR
- Idempotency (15.2/15.3) et ingestion texte (19.2) conformes au périmètre MOV.
- Mode no‑mocks bloquant + scan anti‑mock opérationnels (preuves locales), logs minimaux avec `correlation_id` présents.
- Décision: accepté (MOV) — condition no‑mocks levée par artefacts CI/scripts.

## Références
- PR MOV: https://github.com/KaizenCoder/notebooklm/pull/4
- Preuves no‑mocks publiées en commentaires PR (anti‑mock OK, no‑mocks E2E OK)

## Méthodologie
- Lecture de code et exécution des tests MOV (contract + integration + e2e) localement.
- Exécution ciblée des scripts CI locaux: `ci:anti-mock`, `ci:no-mocks-check`, `ci:local`.
- Contrôle des logs: redaction headers sensibles, `x-correlation-id` en réponse et `correlation_id` dans les logs.

## Vérifications de parité
- HTTP: statuts 202/200/422 attendus selon flux; `Idempotency-Key` respecté sur `process-document` et `process-additional-sources`.
- DB/Storage: upsert(s) déclenchés pour texte; pas de doublons sous replays idempotents.
- Logs/erreurs: redaction `authorization`/`idempotency-key`; corrélation et évènements d’étapes côté ingestion.

## Résultats
- Tests contractuels: PASS (cf. #TEST ci‑dessus).
- Intégration/E2E: PASS sur périmètre MOV.
- Anti‑mock (runtime): OK — aucun motif suspect détecté.
- No‑mocks E2E (NO_MOCKS=1): OK — scénario minimal passe.

## Recommandations & décisions
- Décision: accepté (MOV) pour 15.2/15.3/19.2.
- Conserver les scripts `prepare:hooks`, `ci:anti-mock`, `ci:no-mocks-check`, `ci:local` comme garde‑fous locaux.

## Limitations
- Hors scope MOV: PDF bridge réel, audio avancé, tests unitaires adapters tiers.
- GPU guard dépend de la présence de modèles requis; toléré en MOV.

## Suivi Task‑Master
- 15.2: IMPL en done (MOV)
- 15.3: TEST en done (MOV)
- 19.2: IMPL en review → accepté MOV

## Historique versions
- v1.0 (indépendant) — 2025‑08‑12

## Points d’attention
- Veiller à la stabilité du hook pre‑push PowerShell; fallback Bash/WSL documenté.
