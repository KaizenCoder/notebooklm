---
title: "MOV: Additional sources (texte) 19.3 — consolidation callbacks/idempotency"
doc_kind: audit
team: team-01
team_name: foundations
tm_ids: [19.3, 15.2, 15.3]
scope: process-additional-sources|idempotency
status: draft
version: 1.0
author: ia
related_files: [
  "orchestrator/src/app.ts",
  "orchestrator/src/services/document.ts",
  "orchestrator/test/contract/additional-sources.test.ts",
  "orchestrator/test/contract/idempotency-additional-sources.test.ts"
]
---

# Audit — MOV: Additional sources (texte) 19.3 — consolidation callbacks/idempotency

#TEST: orchestrator/test/contract/additional-sources.test.ts
#TEST: orchestrator/test/contract/idempotency-additional-sources.test.ts

## Résumé (TL;DR)

- Objet: Vérifier flux additional-sources (copied-text/multiple-websites) en MOV: upload `.txt`, indexation, idempotency.
- Décision: Conforme MOV — tests PASS; callbacks implicites via pipeline unifié (docProc + storage) OK.
- Points bloquants: Extraction HTML avancée non couverte (hors périmètre MOV).

## Références

- Spécifications: `docs/TECHNICAL_GUIDELINES.md`
- OpenAPI: `docs/spec/openapi.yaml`
- Annexes payloads: `docs/ANNEXES_PAYLOADS.md`

## Méthodologie

- Jeux d’essai: Suite `additional-sources` + `idempotency-additional-sources`.
- Procédure: Exécution `npm run -s test:contract`; revue `src/app.ts` sur sémantique types/urls/sourceIds.
- ENVs: Utilisation valeurs par défaut/mocks tests.

## Vérifications de parité

- HTTP: `type=copied-text` exige {notebookId, content, sourceId}; `type=multiple-websites` exige {notebookId, urls}.
- Stockage: upload `.txt` présent; indexation via `processDocument`.
- Idempotency: replays renvoient même statut/résultat; pas de retraitement.

## Résultats

- Observations: Batch par URL/sourceId; persistance `.txt` puis indexation; logs d’étapes présents.
- Écarts: Extraction HTML/proxy/config avancés non fournis (attendus hors MOV).
- Captures/logs: Sorties `test:contract` (PASS).

## Recommandations & décisions

- Actions requises: Documenter périmètre MOV vs complet; prévoir lot ultérieur pour HTML avancé.
- Acceptation: Accepté MOV.

## Limitations

- Pas d’évaluation de performance/robustesse réseau pour fetch HTML.

## Suivi Task‑Master

- Tâches liées: 19.3, 15.2, 15.3
- Commandes: `task-master set-status --id=3 --status=done`

## Historique des versions

- v1.0: création de l’audit
